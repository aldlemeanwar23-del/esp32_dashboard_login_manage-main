<script>
async function loadSensor(device) {
  const card = document.getElementById(`sensor${device}`);
  const deviceId = `max${device}`; // تحويل 1,2,3,4 إلى max1..max4
  try {
    const res = await fetch(`/api/sensor?device=${deviceId}`);
    const data = await res.json();

    if (!data.length) {
      card.innerHTML = `<h3>Sensor ${device}</h3><p>No data</p>`;
      return;
    }

    const last = data[data.length - 1];

    card.innerHTML = `
      <h3>MAX30102 — Sensor ${device}</h3>

      <div class="data">
        <span class="label">Heart Rate</span>
        <span class="value">${last.heartrate} BPM</span>
      </div>

      <div class="data">
        <span class="label">SpO₂</span>
        <span class="value">${last.spo2} %</span>
      </div>

      <div class="data">
        <span class="label">Last Update</span>
        <span class="value">
          ${new Date(last.time).toLocaleTimeString()}
        </span>
      </div>

      <button class="open-btn"
        onclick="location.href='dashboard.html?sensor=${deviceId}'">
        Open Live Dashboard
      </button>
    `;
  } catch (err) {
    card.innerHTML = `<h3>Sensor ${device}</h3><p>Error loading</p>`;
    console.error(err);
  }
}

// Load all sensors
[1,2,3,4].forEach(loadSensor);

// Auto refresh every 3s
setInterval(() => {
  [1,2,3,4].forEach(loadSensor);
}, 3000);
</script>
