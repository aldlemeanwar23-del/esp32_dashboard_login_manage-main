<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --primary:#0ea5e9;
  --bg:#020617;
  --card:rgba(255,255,255,.08);
  --border:rgba(255,255,255,.15);
}
body {
  margin:0;
  font-family:Segoe UI, Arial;
  background:var(--bg);
  color:#e5e7eb;
}
/* Top bar */
.top-bar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 30px;
  background:rgba(2,6,23,.8);
  border-bottom:1px solid var(--border);
}
.top-bar h2 {
  margin:0;
  color:var(--primary);
}
.top-bar .actions button {
  margin-left:10px;
  padding:10px 18px;
  background:var(--primary);
  border:none;
  color:#fff;
  border-radius:8px;
  cursor:pointer;
}
.top-bar .actions button:hover {
  opacity:.85;
}
/* Grid */
.container {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:20px;
  padding:30px;
}
/* Card */
.device-card {
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:22px;
  backdrop-filter:blur(10px);
}
.device-card h3 {
  margin:0 0 10px;
  color:var(--primary);
}
.data {
  display:flex;
  justify-content:space-between;
  margin:8px 0;
}
.label {
  opacity:.7;
}
.value {
  font-weight:600;
}
.open-btn {
  width:100%;
  padding:10px;
  margin-top:12px;
  border:none;
  background:#22c55e;
  color:#020617;
  font-weight:700;
  border-radius:8px;
  cursor:pointer;
}
.open-btn:hover {
  opacity:.9;
}
</style>
</head>

<body>

<div class="top-bar">
  <h2>ðŸ©º Admin Health Dashboard</h2>
  <div class="actions">
    <button onclick="location.href='archive.html'">Archive</button>
    <button onclick="location.href='manage.html'">Patients</button>
    <button onclick="logout()">Logout</button>
  </div>
</div>

<div class="container">
  <div class="device-card" id="card1"></div>
  <div class="device-card" id="card2"></div>
  <div class="device-card" id="card3"></div>
  <div class="device-card" id="card4"></div>
</div>

<script>
// ØªØ­ÙˆÙŠÙ„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø³ Ø¥Ù„Ù‰ device_id
function toDeviceId(num) {
  return "max" + num;
}

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙƒÙ„ Ø­Ø³Ø§Ø³
async function loadCard(num) {
  const el = document.getElementById("card" + num);
  const deviceId = toDeviceId(num);

  try {
    const res = await fetch(`/api/sensor?device=${deviceId}`);
    const data = await res.json();

    if (!data || !Array.isArray(data) || data.length === 0) {
      el.innerHTML = `<h3>Sensor ${num}</h3><p>No data</p>`;
      return;
    }

    const last = data[data.length - 1];

    el.innerHTML = `
      <h3>MAX30102 â€” ${deviceId.toUpperCase()}</h3>

      <div class="data">
        <span class="label">Heart Rate</span>
        <span class="value">${last.heartrate} BPM</span>
      </div>

      <div class="data">
        <span class="label">SpOâ‚‚</span>
        <span class="value">${last.spo2} %</span>
      </div>

      <div class="data">
        <span class="label">Time</span>
        <span class="value">${new Date(last.time).toLocaleTimeString()}</span>
      </div>

      <button class="open-btn" onclick="openDashboard('${deviceId}')">
        Open Live Dashboard
      </button>
    `;
  } catch (e) {
    el.innerHTML = `<h3>Sensor ${num}</h3><p>Error loading</p>`;
    console.error(e);
  }
}

// ÙØªØ­ ØµÙØ­Ø© dashboard Ù„ÙƒÙ„ Ø¬Ù‡Ø§Ø²
function openDashboard(deviceId) {
  location.href = `dashboard.html?sensor=${deviceId}`;
}

function logout() {
  localStorage.removeItem('auth');
  location.href = "/login.html";
}

// ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
[1,2,3,4].forEach(loadCard);

// ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ
setInterval(() => [1,2,3,4].forEach(loadCard), 3000);
</script>

</body>
</html>
