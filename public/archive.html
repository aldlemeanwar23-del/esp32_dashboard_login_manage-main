<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Archived Sensor Data</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --primary:#0ea5e9;
  --secondary:#00ffff;
  --bg:#0c111b;
  --card:rgba(255,255,255,0.05);
  --border:rgba(255,255,255,0.2);
  --hover:rgba(0,255,255,0.1);
  --font:'Segoe UI', Arial;
}

body {
  margin:0;
  font-family:var(--font);
  background:var(--bg);
  color:#fff;
}

.top-bar {
  width:95%;
  margin:20px auto;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.top-bar h2 {
  color:var(--secondary);
}

.top-bar button {
  padding:8px 16px;
  border:none;
  border-radius:8px;
  background:var(--primary);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

.search-bar {
  width:95%;
  margin:10px auto 20px auto;
  display:flex;
  justify-content:flex-end;
  gap:10px;
}

.search-bar input {
  padding:6px 10px;
  border-radius:6px;
  border:1px solid var(--border);
  background:#020617;
  color:#fff;
}

.search-bar button {
  padding:6px 14px;
  border-radius:6px;
  border:none;
  background:var(--primary);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

.search-bar button.secondary {
  background:#334155;
}

table {
  width:95%;
  margin:auto;
  border-collapse:separate;
  border-spacing:0;
  background:var(--card);
  border-radius:12px;
  overflow:hidden;
}

th,td {
  padding:8px;
  text-align:center;
  border-bottom:1px solid var(--border);
}

th {
  background:#001f2f;
}

tr:hover {
  background:var(--hover);
}

.placeholder {
  width:95%;
  margin:40px auto;
  text-align:center;
  opacity:0.7;
  font-size:16px;
}
</style>
</head>

<body>

<script>
if(localStorage.getItem('auth')!=='1') location.href='/login.html';
</script>

<div class="top-bar">
  <h2>ğŸ“¦ Archive</h2>
  <button onclick="location.href='admin.html'">â† Back</button>
</div>

<div class="search-bar">
  <input id="searchInput" placeholder="Search by patient name">
  <button onclick="searchArchive()">Search</button>
  <button class="secondary" id="toggleBtn" onclick="toggleAll()">Show All</button>
</div>

<div id="placeholder" class="placeholder">
  ğŸ” Search by patient name or click "Show All"
</div>

<table id="archiveTable" style="display:none">
<thead>
<tr>
  <th>ID</th>
  <th>Device</th>
  <th>Patient Name</th>
  <th>Heart Rate</th>
  <th>SpOâ‚‚</th>
  <th>Date</th>
</tr>
</thead>
<tbody id="archiveRows"></tbody>
</table>

<script>
let allVisible = false;

/* Ø¯Ø§Ù„Ø© Ø¹Ø§Ù…Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
async function fetchArchive(url) {
  const tbody = document.getElementById('archiveRows');
  const table = document.getElementById('archiveTable');
  const placeholder = document.getElementById('placeholder');

  const res = await fetch(url);
  const text = await res.text();
  const data = text ? JSON.parse(text) : [];

  tbody.innerHTML = '';
  table.style.display = 'table';
  placeholder.style.display = 'none';

  if (!data.length) {
    tbody.innerHTML = `<tr><td colspan="6">No data found</td></tr>`;
    return;
  }

  data.forEach(r => {
    tbody.innerHTML += `
      <tr>
        <td>${r.id}</td>
        <td>${r.device_id}</td>
        <td>${r.p_name || ''}</td>
        <td>${r.heartrate}</td>
        <td>${r.spo2}</td>
        <td>${new Date(r.timestamp).toLocaleString()}</td>
      </tr>
    `;
  });
}

/* Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… */
function searchArchive() {
  const search = document.getElementById('searchInput').value.trim();
  if (!search) {
    alert('Please enter patient name');
    return;
  }

  allVisible = false;
  document.getElementById('toggleBtn').innerText = 'Show All';

  fetchArchive('/api/archiveGet?search=' + encodeURIComponent(search));
}

/* Ø²Ø± Ø¥Ø¸Ù‡Ø§Ø± / Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒÙ„ */
function toggleAll() {
  const table = document.getElementById('archiveTable');
  const placeholder = document.getElementById('placeholder');
  const btn = document.getElementById('toggleBtn');

  if (allVisible) {
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    table.style.display = 'none';
    placeholder.style.display = 'block';
    btn.innerText = 'Show All';
    allVisible = false;
  } else {
    // Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    document.getElementById('searchInput').value = '';
    fetchArchive('/api/archiveGet');
    btn.innerText = 'Hide All';
    allVisible = true;
  }
}
</script>

</body>
</html>
