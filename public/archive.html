<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Archived Sensor Data</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --primary:#0ea5e9;
  --secondary:#00ffff;
  --bg:#0c111b;
  --card:rgba(255,255,255,0.05);
  --border:rgba(255,255,255,0.2);
  --hover:rgba(0,255,255,0.1);
  --font:'Segoe UI', Arial;
}

body {
  margin:0;
  font-family:var(--font);
  background:var(--bg);
  color:#fff;
}

.top-bar {
  width:95%;
  margin:20px auto;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.top-bar h2 {
  color:var(--secondary);
}

.top-bar button {
  padding:8px 16px;
  border:none;
  border-radius:8px;
  background:var(--primary);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

.search-bar {
  width:95%;
  margin:10px auto;
  display:flex;
  justify-content:flex-end;
  gap:10px;
}

.search-bar input {
  padding:6px 10px;
  border-radius:6px;
  border:1px solid var(--border);
  background:#020617;
  color:#fff;
}

.search-bar button {
  padding:6px 14px;
  border-radius:6px;
  border:none;
  background:var(--primary);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

table {
  width:95%;
  margin:auto;
  border-collapse:separate;
  border-spacing:0;
  background:var(--card);
  border-radius:12px;
  overflow:hidden;
}

th,td {
  padding:8px;
  text-align:center;
  border-bottom:1px solid var(--border);
}

th {
  background:#001f2f;
}

tr:hover {
  background:var(--hover);
}
</style>
</head>

<body>

<script>
if(localStorage.getItem('auth')!=='1') location.href='/login.html';
</script>

<div class="top-bar">
  <h2>üì¶ Archive</h2>
  <button onclick="location.href='admin.html'">‚Üê Back</button>
</div>

<div class="search-bar">
  <input id="searchInput" placeholder="Search by patient name">
  <button onclick="loadArchive()">Search</button>
</div>

<table>
<thead>
<tr>
  <th>ID</th>
  <th>Device</th>
  <th>Patient Name</th>
  <th>Heart Rate</th>
  <th>SpO‚ÇÇ</th>
  <th>Date</th>
</tr>
</thead>
<tbody id="archiveRows"></tbody>
</table>

<script>
/* ====== LOAD ARCHIVE (GLOBAL FUNCTION) ====== */
async function loadArchive() {
  const search = document.getElementById('searchInput').value || '';

  try {
    const res = await fetch('/api/archiveGet?search=' + encodeURIComponent(search));
    const text = await res.text();

    const data = text ? JSON.parse(text) : [];
    const tbody = document.getElementById('archiveRows');
    tbody.innerHTML = '';

    if (!data.length) {
      tbody.innerHTML = `<tr><td colspan="6">No archived data</td></tr>`;
      return;
    }

    data.forEach(r => {
      tbody.innerHTML += `
        <tr>
          <td>${r.id}</td>
          <td>${r.device_id}</td>
          <td>${r.p_name || ''}</td>
          <td>${r.heartrate}</td>
          <td>${r.spo2}</td>
          <td>${new Date(r.timestamp).toLocaleString()}</td>
        </tr>
      `;
    });

  } catch (err) {
    console.error(err);
    alert('Failed to load archive');
  }
}



/* ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿπŸÜÿØ ŸÅÿ™ÿ≠ ÿßŸÑÿµŸÅÿ≠ÿ© */
loadArchive();
</script>

</body>
</html>
