<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Device Details</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin:0;
  font-family:Segoe UI;
  background:#0a0f1a;
  color:#fff;
}
header {
  display:flex;
  justify-content:space-between;
  padding:15px 25px;
  background:#001f2f;
  color:#00ffff;
}
.container {
  padding:20px;
}
.results {
  display:flex;
  gap:15px;
  margin-bottom:20px;
}
.card {
  flex:1;
  background:rgba(0,255,255,.1);
  padding:15px;
  border-radius:12px;
  text-align:center;
}
canvas {
  width:100%;
  height:160px !important;
  background:rgba(0,0,0,.3);
  border-radius:12px;
  margin-bottom:15px;
}
</style>
</head>
<body>

<header>
  <div>Device: <span id="deviceName"></span></div>
  <button onclick="history.back()">← Back</button>
</header>

<div class="container">
  <div class="results">
    <div class="card">
      <h3>Heart Rate</h3>
      <div id="hr">--</div>
    </div>
    <div class="card">
      <h3>SpO₂</h3>
      <div id="spo">--</div>
    </div>
  </div>

  <canvas id="hrChart"></canvas>
  <canvas id="spoChart"></canvas>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const device = params.get('device'); // ✔️ التصحيح المهم

document.getElementById('deviceName').innerText = device.toUpperCase();

const hrChart = new Chart(hrChartEl = document.getElementById('hrChart'), {
  type:'line',
  data:{labels:[],datasets:[{data:[],borderColor:'#00ffff'}]},
  options:{animation:false,maintainAspectRatio:false}
});

const spoChart = new Chart(document.getElementById('spoChart'), {
  type:'line',
  data:{labels:[],datasets:[{data:[],borderColor:'#ff00ff'}]},
  options:{animation:false,maintainAspectRatio:false}
});

async function load(){
  const res = await fetch(`/api/sensor?device=${device}`);
  const data = await res.json();

  if(!Array.isArray(data) || data.length === 0) return;

  const last = data[data.length - 1];
  document.getElementById('hr').innerText = last.heartrate + ' BPM';
  document.getElementById('spo').innerText = last.spo2 + ' %';

  const t = new Date(last.time).toLocaleTimeString();

  hrChart.data.labels.push(t);
  hrChart.data.datasets[0].data.push(last.heartrate);
  hrChart.update();

  spoChart.data.labels.push(t);
  spoChart.data.datasets[0].data.push(last.spo2);
  spoChart.update();
}

load();
setInterval(load,2000);
</script>

</body>
</html>
