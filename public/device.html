<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Device Details</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  background:#0a0f1a;
  color:#fff;
  font-family:Segoe UI;
  margin:0;
  padding:0;
}
header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:15px 20px;
  background:#001f2f;
  color:#00ffff;
  font-size:20px;
}
header button {
  padding:8px 16px;
  border:none;
  border-radius:6px;
  background:#00ffff;
  color:#020617;
  font-weight:bold;
  cursor:pointer;
}
header button:hover {
  background:#00bcd4;
}
.container {
  padding:20px;
}
.results {
  display:flex;
  justify-content:space-around;
  margin-bottom:20px;
}
.result-card {
  background:rgba(0,255,255,0.1);
  padding:15px 20px;
  border-radius:10px;
  text-align:center;
  flex:1;
  margin:0 10px;
}
.result-card h3 {
  margin:0 0 10px 0;
  font-size:16px;
  color:#00ffff;
}
.result-card .value {
  font-size:30px;
  font-weight:bold;
}
canvas {
  background:rgba(0,0,0,0.3);
  border-radius:12px;
  padding:10px;
  margin-bottom:20px;
}
</style>
</head>
<body>

<header>
  <span>Device Details: <span id="deviceName"></span></span>
  <button onclick="location.href='admin.html'">← Back</button>
</header>

<div class="container">
  <div class="results">
    <div class="result-card">
      <h3>Heart Rate</h3>
      <div class="value" id="hr">-- BPM</div>
    </div>
    <div class="result-card">
      <h3>SpO₂</h3>
      <div class="value" id="spo">-- %</div>
    </div>
  </div>

 <canvas id="hrChart" height="120"></canvas>
 <canvas id="spoChart" height="120"></canvas>

</div>

<script>
const params = new URLSearchParams(window.location.search);
const device = params.get('sensor') || 'max1';
document.getElementById('deviceName').innerText = device.toUpperCase();

let labels = [], hrData = [], spoData = [];

const hrChart = new Chart(document.getElementById('hrChart'), {
  type:'line',
  data:{labels, datasets:[{label:'Heart Rate', data:hrData, borderColor:'#00ffff', fill:true}]},
  options:{responsive:true, animation:false}
});

const spoChart = new Chart(document.getElementById('spoChart'), {
  type:'line',
  data:{labels, datasets:[{label:'SpO₂', data:spoData, borderColor:'#ff00ff', fill:true}]},
  options:{responsive:true, animation:false}
});

async function loadData() {
  try {
    const res = await fetch(`/api/sensor?device=${device}`);
    const data = await res.json();
    if (!data || data.length===0) return;

    const last = data[data.length-1];
    document.getElementById('hr').innerText = last.heartrate + ' BPM';
    document.getElementById('spo').innerText = last.spo2 + ' %';

    labels.length = hrData.length = spoData.length = 0;
    data.slice(-100).forEach(r => {
      labels.push('');
      hrData.push(r.heartrate);
      spoData.push(r.spo2);
    });

    hrChart.update();
    spoChart.update();
  } catch(e){
    console.error('Error fetching device data:', e);
  }
}

loadData();
setInterval(loadData, 2000);
</script>

</body>
</html>
